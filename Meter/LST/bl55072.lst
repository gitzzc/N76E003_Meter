C51 COMPILER V9.50a   BL55072                                                              12/04/2017 14:02:12 PAGE 1   


C51 COMPILER V9.50a, COMPILATION OF MODULE BL55072
OBJECT MODULE PLACED IN .\Output\bl55072.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Code\bl55072.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Include) DEFINE(
                    -FOSC_160000) DEBUG OBJECTEXTEND PRINT(.\LST\bl55072.lst) OBJECT(.\Output\bl55072.obj)

line level    source

   1          #include "N76E003.h"
   2          #include "Common.h"
   3          #include "Delay.h"
   4          #include "SFR_Macro.h"
   5          #include "Function_define.h"
   6          
   7          #include "bl55072.h"
   8          #include "bike.h"
   9          
  10          #define I2C_CLOCK               13
  11          #define I2C_WRITE               0
  12          #define I2C_READ                    1
  13          
  14          
  15          //========================================================================================================
  16          void Init_I2C(void)
  17          {
  18   1      //  /* Set I2C clock rate */
  19   1          I2CLK = I2C_CLOCK; 
  20   1      
  21   1          /* Enable I2C */
  22   1          set_I2CEN;                                   
  23   1      }
  24          //========================================================================================================
  25          void I2C_Error(void)
  26          {
  27   1      //    P3 = I2STAT;
  28   1      //    P3 = ERROR_CODE;
  29   1      //    while (1);    
  30   1      }
  31          //========================================================================================================
  32          unsigned char I2C_WriteBuf(unsigned char chip,unsigned char* buf, unsigned char len)
  33          {
  34   1          UINT8 u8Count;
  35   1      
  36   1              Init_I2C();
  37   1      
  38   1          /* Step1 */
  39   1          set_STA;                                    /* Send Start bit to I2C EEPROM */
  40   1          clr_SI;
  41   1          while (!SI);                                //Check SI set or not
  42   1          if (I2STAT != 0x08) {                       //Check status value after every step
  43   2              I2C_Error();
  44   2                      return 0;
  45   2              }
  46   1          
  47   1          /* Step2 */
  48   1          clr_STA;                                    //STA=0
  49   1          I2DAT = (chip | I2C_WRITE);
  50   1          clr_SI;
  51   1          while (!SI);                                //Check SI set or not
  52   1          if (I2STAT != 0x18) {
  53   2              I2C_Error();
  54   2                      return 0;
C51 COMPILER V9.50a   BL55072                                                              12/04/2017 14:02:12 PAGE 2   

  55   2              }
  56   1      
  57   1          /* Step5 */
  58   1          for (u8Count = 0; u8Count < len; u8Count++)
  59   1          {
  60   2              I2DAT = buf[u8Count];
  61   2              clr_SI;
  62   2              while (!SI);                            //Check SI set or not
  63   2              if (I2STAT != 0x28) {
  64   3                  I2C_Error();
  65   3                              return 0;
  66   3                      }
  67   2          }
  68   1      
  69   1          /* Step7 */
  70   1          set_STO;
  71   1          clr_SI;
  72   1          while (STO);                                /* Check STOP signal */
  73   1      
  74   1              return 1;
  75   1      }
  76          
  77          unsigned char BL_Write_Data(unsigned char ADSTART,unsigned char LEN, unsigned char * p)
  78          {
  79   1              unsigned char reg_buf[19];
  80   1              unsigned char i;
  81   1              
  82   1              if ( ADSTART + LEN > 19 ) return 0;
  83   1              
  84   1              reg_buf[0] = 0;
  85   1              for(i=0;i<LEN;i++)
  86   1                      reg_buf[i+1] = p[i];
  87   1              
  88   1              return I2C_WriteBuf(BL_ADDR,reg_buf,LEN+1);     
  89   1      }
  90          
  91          void BL55072_Config(unsigned char status)
  92          {
  93   1              unsigned char BL_Reg[6];
  94   1      
  95   1              BL_Reg[0] = 0xEE;       //ICSET InnerOsc,softrst
  96   1              BL_Reg[1] = 0xF0;       //BLKCTL BlinkingOff
  97   1              BL_Reg[2] = 0xFD;       //DISCTL 50Hz,Line inversion mode,high power mode
  98   1              BL_Reg[3] = 0xEC;       //ICSET InnerOsc
  99   1              BL_Reg[4] = 0xC8;       //MODESET Display on,1/3 bias
 100   1              switch(status){
 101   2                      case 0: BL_Reg[5] = 0xFC; break;        //APCTL normal
 102   2                      case 1: BL_Reg[5] = 0xFE; break;        //APCTL Apon
 103   2                      case 2: BL_Reg[5] = 0xFC; BL_Reg[1] = 0xF3; break;      //APCTL normal,1Hz
 104   2                      default: break;
 105   2              }
 106   1      
 107   1              I2C_WriteBuf(BL_ADDR,BL_Reg,6);
 108   1      }
 109          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    296    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      34
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.50a   BL55072                                                              12/04/2017 14:02:12 PAGE 3   

   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
